from cmu_graphics import *
from PIL import Image
import os, pathlib

def openImage(fileName):
        return Image.open(os.path.join(pathlib.Path(__file__).parent,fileName))

def onAppStart(app):
    #Mario height and width
    #Default mariox and y values are 100, 250
    app.mariox, app.marioy = 100, 250
    app.marioState = 'idle'
    app.bigMarioWalkRight = openImage('C:\CMU wrk\\15-112\Supra Mario Bros 4.5\imgs\\bigMarioWalkRight.png')
    app.bigMarioIdleRight = openImage('C:\CMU wrk\\15-112\Supra Mario Bros 4.5\imgs\\bigMarioIdleRight.png')
    app.bigMarioImageWidth,app.bigMarioImageHeight = app.bigMarioWalkRight.width,app.bigMarioWalkRight.height
    app.bigMarioIdleRightWidth, app.bigMarioIdleRightHeight = app.bigMarioIdleRight.width,app.bigMarioIdleRight.height
    app.bigMarioIdleRight = CMUImage(app.bigMarioIdleRight)
    print(f'Mario Width: {app.bigMarioImageWidth}, Mario Height: {app.bigMarioImageHeight}')


    app.sprites = [ ]
    for i in range(2):
        # Split up the spritestrip into its separate sprites
        # then save them in a list
        frame = app.bigMarioWalkRight.crop((100 + 530*i, 30, 400 + 530*i, 430))
        sprite = CMUImage(frame)
        app.sprites.append(sprite)
        
    # app.spriteCounter shows which sprite (of the list) 
    # we should currently display
    app.spriteCounter = 0
    app.stepCounter = 0
    app.stepsPerSecond = 30

def onStep(app):
    app.stepCounter += 1
    if app.stepCounter>= 8:
        app.spriteCounter = (1 + app.spriteCounter) % len(app.sprites)
        app.stepCounter = 0 

def onKeyHold(app, keys):
    isMarioMoving = False
    if 'right' in keys:
        app.mariox += 6
        isMarioMoving = True
    elif 'left' in keys:
        app.mariox -= 6
        isMarioMoving = True
    app.marioState = 'walking' if isMarioMoving else 'idle'


def redrawAll(app):
    if app.marioState == 'walking':
        sprite = app.sprites[app.spriteCounter]
        #Default mariox and y values are 100, 250
        drawImage(sprite, app.mariox, app.marioy, align = 'center')
    else:
        drawImage(app.bigMarioIdleRight, app.mariox, app.marioy, align = 'center')

def main():
    runApp(width=700, height=500)

if __name__ == '__main__':
    main()